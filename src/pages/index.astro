---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import ScrollToTop from '../components/ScrollToTop.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { getPosts, getACFOptions, toEasyIOUrl, POSTS_PER_PAGE } from '../lib/wordpress';
import '../styles/global.css';

const { posts, totalPages, totalPosts } = await getPosts(1, POSTS_PER_PAGE);
const acfOptions = await getACFOptions();
const homepageTitle = acfOptions.homepage_title || 'Latest Posts';
const currentPage = 1;
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
		<main class="w-full px-4 py-16">
			<h1 class="text-3xl font-bold text-center mb-12 text-gray-900 max-w-[1600px] mx-auto">{homepageTitle}</h1>
			
			<!-- Mobile Promotional Banners (horizontal) -->
			<div class="flex lg:hidden gap-4 justify-center mb-8 max-w-[1600px] mx-auto">
				{acfOptions.promo_image_1?.url && (
					<a 
						href={acfOptions.promo_link_1 || '#'}
						class="group relative block w-32 h-32 sm:w-40 sm:h-40 overflow-hidden rounded-lg shadow-sm hover:shadow-xl transition-all duration-500"
						target={acfOptions.promo_link_1_new_tab ? '_blank' : '_self'}
						rel={acfOptions.promo_link_1_new_tab ? 'noopener noreferrer' : undefined}
					>
						<img 
							src={toEasyIOUrl(acfOptions.promo_image_1.url)} 
							alt={acfOptions.promo_image_1.alt || 'Promotional banner'}
							class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
							loading="lazy"
							width="160"
							height="160"
						/>
						{acfOptions.promo_text_1 && (
							<span class="absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/50 text-[#EED0C5] text-xs sm:text-sm font-bold text-center px-2 transition-all duration-500 opacity-0 group-hover:opacity-100 backdrop-blur-sm">
								<span class="transform translate-y-4 group-hover:translate-y-0 transition-transform duration-500">{acfOptions.promo_text_1}</span>
							</span>
						)}
					</a>
				)}
				{acfOptions.promo_image_2?.url && (
					<a 
						href={acfOptions.promo_link_2 || '#'}
						class="group relative block w-32 h-32 sm:w-40 sm:h-40 overflow-hidden rounded-lg shadow-sm hover:shadow-xl transition-all duration-500"
						target={acfOptions.promo_link_2_new_tab ? '_blank' : '_self'}
						rel={acfOptions.promo_link_2_new_tab ? 'noopener noreferrer' : undefined}
					>
						<img 
							src={toEasyIOUrl(acfOptions.promo_image_2.url)} 
							alt={acfOptions.promo_image_2.alt || 'Promotional banner'}
							class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
							loading="lazy"
							width="160"
							height="160"
						/>
						{acfOptions.promo_text_2 && (
							<span class="absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/50 text-[#EED0C5] text-xs sm:text-sm font-bold text-center px-2 transition-all duration-500 opacity-0 group-hover:opacity-100 backdrop-blur-sm">
								<span class="transform translate-y-4 group-hover:translate-y-0 transition-transform duration-500">{acfOptions.promo_text_2}</span>
							</span>
						)}
					</a>
				)}
			</div>

			<div class="flex flex-col lg:flex-row gap-6 max-w-[1600px] mx-auto">
				<!-- Left Promotional Banners (desktop only) -->
				<aside class="hidden lg:flex flex-col gap-6 w-64 flex-shrink-0">
					<div class="text-center">
						<p class="text-xs font-semibold text-[#585858] tracking-wide leading-relaxed">
							E-FILE MANICURE | E-FILE PEDICURE | NAIL DRILL BITS
						</p>
						<p class="text-sm font-bold text-[#EED0C5] mt-1">
							RUSSIAN DRILL BITS
						</p>
					</div>
					{acfOptions.promo_image_1?.url && (
						<a 
							href={acfOptions.promo_link_1 || '#'}
							class="group relative block aspect-square overflow-hidden rounded-lg shadow-sm hover:shadow-xl transition-all duration-500"
							target={acfOptions.promo_link_1_new_tab ? '_blank' : '_self'}
							rel={acfOptions.promo_link_1_new_tab ? 'noopener noreferrer' : undefined}
						>
							<img 
								src={toEasyIOUrl(acfOptions.promo_image_1.url)} 
								alt={acfOptions.promo_image_1.alt || 'Promotional banner'}
								class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
								loading="lazy"
								width="256"
								height="256"
							/>
							{acfOptions.promo_text_1 && (
								<span class="absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/50 text-[#EED0C5] text-sm font-bold text-center px-3 transition-all duration-500 opacity-0 group-hover:opacity-100 backdrop-blur-sm">
									<span class="transform translate-y-4 group-hover:translate-y-0 transition-transform duration-500">{acfOptions.promo_text_1}</span>
								</span>
							)}
						</a>
					)}
					{acfOptions.promo_image_2?.url && (
						<a 
							href={acfOptions.promo_link_2 || '#'}
							class="group relative block aspect-square overflow-hidden rounded-lg shadow-sm hover:shadow-xl transition-all duration-500"
							target={acfOptions.promo_link_2_new_tab ? '_blank' : '_self'}
							rel={acfOptions.promo_link_2_new_tab ? 'noopener noreferrer' : undefined}
						>
							<img 
								src={toEasyIOUrl(acfOptions.promo_image_2.url)} 
								alt={acfOptions.promo_image_2.alt || 'Promotional banner'}
								class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
								loading="lazy"
								width="256"
								height="256"
							/>
							{acfOptions.promo_text_2 && (
								<span class="absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/50 text-[#EED0C5] text-sm font-bold text-center px-3 transition-all duration-500 opacity-0 group-hover:opacity-100 backdrop-blur-sm">
									<span class="transform translate-y-4 group-hover:translate-y-0 transition-transform duration-500">{acfOptions.promo_text_2}</span>
								</span>
							)}
						</a>
					)}
				</aside>

				<!-- Main Content -->
				<div class="flex-1">
					<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
				{posts.map((post, index) => {
					// Use medium_large size (max 768px) for better performance
					const featuredImageRaw = post._embedded?.['wp:featuredmedia']?.[0]?.media_details?.sizes?.medium_large?.source_url || post._embedded?.['wp:featuredmedia']?.[0]?.source_url;
					const featuredImage = toEasyIOUrl(featuredImageRaw);
					const categories = post._embedded?.['wp:term']?.[0]?.map(cat => cat.name) || [];
					// First image is LCP - prioritize it
					const isFirstImage = index === 0;
					
					return (
						<article class="bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-lg transition-all duration-300 border border-gray-200">
						{featuredImage && (
							<a href={`/blog/${post.slug}`}>
								<img 
									src={featuredImage} 
									alt={post.title.rendered}
									class="w-full h-48 object-cover"
									loading={isFirstImage ? "eager" : "lazy"}
									fetchpriority={isFirstImage ? "high" : "auto"}
									width="768"
									height="384"
								/>
								</a>
							)}
							
							<div class="p-6">
								{categories.length > 0 && (
									<div class="flex gap-2 mb-3 flex-wrap">
										{categories.map(cat => (
											<span class="text-xs font-medium bg-[#EED0C5]/20 text-[#585858] px-2.5 py-1 rounded uppercase tracking-wide">
												{cat}
											</span>
										))}
									</div>
								)}
								
								<h2 class="text-lg font-semibold mb-2 leading-tight">
									<a href={`/blog/${post.slug}`} class="text-gray-900 hover:text-[#EED0C5] transition-colors">
										{post.title.rendered}
									</a>
								</h2>
								
								<time class="text-sm text-gray-500 mb-4 block font-medium">
									{new Date(post.date).toLocaleDateString('en-GB', { 
										year: 'numeric', 
										month: 'long', 
										day: 'numeric' 
									})}
								</time>
								
								<div class="text-gray-600 mb-6 line-clamp-3 text-base leading-relaxed" set:html={post.excerpt.rendered} />
								
								<a 
									href={`/blog/${post.slug}`}
									class="inline-flex items-center text-[#EED0C5] hover:text-[#d4b5aa] font-semibold text-sm transition-colors group"
								>
									Read more
									<svg class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
									</svg>
								</a>
							</div>
						</article>
					);
				})}
			</div>

			{/* Pagination */}
			{totalPages > 1 && (
				<nav class="flex justify-center items-center gap-2 mt-12" aria-label="Page navigation">
					{/* Previous button - disabled on first page */}
					<span class="px-4 py-2 text-gray-400 cursor-not-allowed">
						← Previous
					</span>

					{/* Page numbers */}
					{Array.from({ length: totalPages }, (_, i) => i + 1).map((page) => (
						<a
							href={page === 1 ? '/' : `/page/${page}`}
							class={`px-4 py-2 rounded-lg font-medium transition-colors ${
								page === currentPage
									? 'bg-[#EED0C5] text-[#585858]'
									: 'bg-white text-[#585858] hover:bg-gray-100 border border-gray-200'
							}`}
							aria-current={page === currentPage ? 'page' : undefined}
						>
							{page}
						</a>
					))}

					{/* Next button */}
					{totalPages > 1 && (
						<a href="/page/2" class="px-4 py-2 text-[#EED0C5] hover:text-[#d4b5aa] font-medium transition-colors">
							Next →
						</a>
					)}
				</nav>
			)}
				</div>
			</div>
		</main>
		<Footer />
		<ScrollToTop />
	</body>
</html>
